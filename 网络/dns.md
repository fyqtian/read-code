## DNS

https://zhuanlan.zhihu.com/p/88260838

http://c.biancheng.net/view/6457.html

https://www.cnblogs.com/joycamp/p/13498104.html

1、 **什么是DNS协议？**

1. DNS协议就是用来将**域名解析到IP**地址的一种协议，当然，也可以将**IP地址转换为域名**的一种协议。
2. DNS协议基**于UDP和TCP**协议的，端口号**53**，用户到服务器采用UDP，DNS**服务器通信采用TCP**
3. 大型运营商、互联网机构等会向公众提供免费的DNS服务，例如，谷歌的8.8.8.8 8.8.4.4 阿里巴巴223.5.5.5 223.6.6.6
4. 如果DNS服务器down掉了，那么你只能通过IP地址来访问服务了。
5. 我们从以下几部分来理解DNS协议：







## 域名结构

**像Linux目录结构一样**，现代因特网采用层次**树状结构**的命名方法，任何一个连接在因特网上的主机或路由器，都有一个唯一的层次结构的名字，该名字称为域名。

例如：xxx.yyy.zzz.com
从右边的**com是顶级域名**，到左依次是：二级域名，三级域名，四级域名

域名的分级：域名可以**划分为各个子域**，子域还可以继续划分为**子域的子域**，这样就形成了顶级域、二级域、三级域等。

其中顶级域名分为：国家顶级域名、通用顶级域名、反向域名。

```
国家顶级域名：中国:cn， 美国:us，英国uk...
通用顶级域名：com 公司企业  edu教育机构 gov政府部门  int国际组织  mil军事部门  net网络 org非盈利组织...
反向域名：只有一个arpa，用于PTR查询（IP地址转换为域名） 。 
```

### 域名服务器

域名服务器主要分为：**根域名**服务器、**顶级域名**服务器、**权限域名**服务器、**本地域名**服务器。

先举个例子来看一下各个服务器之间的联系：

当一个应用要通过DNS来查询某个主机名，比如www.google.com的ip时，粗略地说，查询过程是这样的：**它先与根服务器之一联系**，根服务器根据顶级域名com，会响应命名空间为com的顶级域服务器的ip；于是该应用接着向com顶级域服务器发出请求，com顶级域服务器会响应命名空间为google.com的权威DNS服务器的ip地址；最后该应用将请求命名空间为google.com的权威DNS服务器，该权威DNS服务器会响应主机名为www.google.com的ip。

实际上，除了上图层次结构中所展示的DNS外，还有一类与我们接触更为密切的DNS服务器，**它们是本地DNS服务器**，我们经常在电脑上配置的DNS服务器通常就是此类。它们一般由某公司，某大学，或某居民区提供，比如Google提供的DNS服务器8.8.8.8；比如常被人诟病的114.114.114.114等。



**根域名服务器**
根服务器主要用来管理互联网的主目录。
所有根服务器均由美国政府授权的互联网域名与号码分配机构ICANN统一管理，负责全球互联网域名根服务器、域名体系和IP地址等的管理。
全球共有**13台根**服务器（实际有镜像）。1个为根服务器架构主根服务器，放置在美国。其余12个均为辅根服务器，其中9个放置在美国，欧洲2个，位于英国和瑞典，亚洲1个，位于日本。 据说，在主根服务器系统上还有一个更高级的、隐藏着的母服务器，当然也在美国，而全世界所有的顶级域名都是由这台母服务器来确定的。
中国还没有自己的根服务器。都是根服务器的镜像（5个）



### 域名查询

查询方式分为**递归查询**和**迭代查询**



当客户机提出查询请求时，**首先在本地计算机的缓存中查找**，如果在本地无法查询信息，则将查询请求发给DNS服务器

2）首先客户机将域名查询请求发送到**本地DNS服务器**（局域网），当本地DNS服务器接到查询后，首先在该服务器管理的区域的记录中查找，如果找到该记录，则进行此记录进行解析，如果没有区域信息可以满足查询要求，服务器在本地缓存中查找

3） 如果本地服务器不能在本地找到客户机查询的信息，将客户机请求发送到**根域名DNS服务器**

4） 根域名服务器负责解析客户机请求的根域名部分，它将包**含下一级域名信息的DNS服务器地址地址**，返回给客户机的DNS服务器地址

5） 客户机的DNS服务器利用根域名服务器解析的地址访问下一级DNS服务器，得到再下一级域名的DNS服务器地址

6） 按照上述递归方法逐级接近查询目标，最后在有目标域名的DNS服务器上找到相应IP地址信息

7） 客户机的本地DNS服务器将递归查询结构返回客户机

8） 客户机利用从本地DNS服务器查询得到的IP访问目标主机，就完成了一个解析过程

9） 同时**客户机本地DNS服务器更新其缓存表**，客户机也更新期缓存表，方便以后查询

