### 线程与进程

https://zhuanlan.zhihu.com/p/125716637?utm_source=wechat_session&utm_medium=social&utm_oi=709416223401611264



### 进程和线程基础（理论概念）

###  1. 定义

看了下面的定义，可能会有点晕，但我还是要把他写下来（为了严谨）。
**进程**是资源（CPU、内存等）**分配的基本单位**，具有一定**独立**功能的程序关于某个数据集合上的一次运行活动，进程是系统进行**资源分配和调度**的一个独立单位。



**线程**是进程的一个实体，是**独立运行和独立调度**的基本单位（CPU上真正运行的是线程）。线程自己基本上**不拥有系统资源**，只拥有一点在运行中必**不可少的资源(如程序计数器,一组寄存器和栈)**，但是它可与同属一个进程的其他的**线程共享**进程所拥有的全部资源。





### 2.区别 

1. 进程是**资源分配的基本单位**；线程是**程序执行的基本单位**。
2. 进程拥有自己的资源空间，每启动一个进程，系统就会为**它分配地址空间**；而线程与CPU资源分配无关，多个线程共享同一进程内的资源，使用相同的地址空间。
3. 一个进程可以包含若干个线程。

### 

### 3. 优劣

正是因为这二者有区别，所以带来的各自的优劣

1. 线程之间的**通信更方便**，同一进程下的**线程共享全局变量、静态变量等数据**，而进程之间的通信需要以通信的方式（Inter Process Communication，IPC)进行。不过如何处理好同步与互斥是编写多线程程序的难点。
2. 线程的**调度与切换比进程快很多**，同时创建一个线程的开销也比进程要小很多。**（切换tlb Translation Lookaside Buffer，地址空间）**
3. 但是**多进程程序更健壮**，多线程程序只要有一个线程死掉，整个进程也死掉了，而一个进程死掉并不会对另外一个进程造成影响，因为进程有自己独立的地址空间。





### 线程的本质

1. 栈（堆栈）：主线程的main函数、进行函数调用的参数和返回地址、局部变量等内容都会被压入栈内
2. PC（Program Couner）：程序计数器，PC的指针指向代码所在的内存地址。
3. **TLS（Thread local storage）**：分配内存，存放变量





#### 通信

- 进程/线程如何通信
  答：进程可以通过**管道**、套接字、信号交互、共享内存、消息队列等等进行通信；而线程本身就会共享内存，指针指向同一个内容，交互很容易。
- 通信方式的差异，比如进程间共享内存和消息队列有何异同？